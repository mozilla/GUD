import {csvParse} from 'd3-dsv'
import { sumBucketsWithCI } from '../../src/stores/CI'
const fs = require('fs')

const output = `
|ci|date|value
0|"[0.03666191898574678, 0.03666191898574678]"|2019-01-20|0.37894736842105264
1|"[0.03342201439812126, 0.03342201439812126]"|2019-01-21|0.3310344827586207
2|"[0.03972739967933081, 0.03972739967933081]"|2019-01-22|0.33391003460207613
3|"[0.0389245292499682, 0.03892452924996609]"|2019-01-23|0.3427299703264095
4|"[0.034423580817284194, 0.034423580817284194]"|2019-01-24|0.29253731343283584
5|"[0.04306890386079043, 0.04306890386078832]"|2019-01-25|0.3345388788426763
6|"[0.03204790340551594, 0.03204790340551594]"|2019-01-26|0.34140969162995594
7|"[0.03644486137237263, 0.03644486137237474]"|2019-01-27|0.3568627450980392
8|"[0.0318735972066192, 0.0318735972066192]"|2019-01-28|0.3225283630470016
9|"[0.024384680862453045, 0.024384680862453045]"|2019-01-29|0.33804809052333806
10|"[0.040946839055827244, 0.040946839055827244]"|2019-01-30|0.33712660028449504
11|"[0.027714712613187253, 0.027714712613187253]"|2019-01-31|0.3952153110047847
12|"[0.029285048936187552, 0.029285048936187552]"|2019-02-01|0.4272266473569877
13|"[0.028775920684024348, 0.028775920684024348]"|2019-02-02|0.41960447119518485
14|"[0.028804951656909106, 0.028804951656913325]"|2019-02-03|0.42657342657342656`

const [header,...rest] = output.split('\n')

const parse = str => str.split('|')

const file = fs.readFileSync('./raw_data.csv').toString()

const rawData = csvParse(file).map(d=> {
    d.new_profile =parseInt(d.new_profile)
    d.is_active = parseInt(d.is_active)
    d.bucket = parseInt(d.bucket)
    delete d.id
    return d
})

console.log(rawData.slice(0,10))

describe('Confidence intervals', () => {
    it('should work?', ()=> {
        console.log(sumBucketsWithCI)
        expect(1).toBe(1)
    })
})